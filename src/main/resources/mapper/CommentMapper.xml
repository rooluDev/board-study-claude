<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
  Comment 테이블 MyBatis Mapper

  네임스페이스: com.board.dao.CommentDAO
  설명: 댓글 관련 SQL 쿼리 정의
-->
<mapper namespace="com.board.dao.CommentDAO">

  <!-- Comment 결과 매핑 -->
  <resultMap id="CommentResultMap" type="Comment">
    <id property="commentId" column="comment_id"/>
    <result property="boardId" column="board_id"/>
    <result property="comment" column="comment"/>
    <result property="createdAt" column="created_at"/>
    <result property="editedAt" column="edited_at"/>
  </resultMap>

  <!--
    게시글 ID로 댓글 목록 조회

    파라미터:
    - boardId: 게시글 ID

    반환: List<Comment>
    정렬: 등록일시 오름차순 (오래된 댓글이 먼저)
  -->
  <select id="selectCommentsByBoardId" resultMap="CommentResultMap">
    SELECT
      comment_id,
      board_id,
      comment,
      created_at,
      edited_at
    FROM comment
    WHERE board_id = #{boardId}
    ORDER BY created_at ASC
  </select>

  <!--
    댓글 ID로 댓글 조회

    파라미터:
    - commentId: 댓글 ID

    반환: Comment
  -->
  <select id="selectCommentById" resultMap="CommentResultMap">
    SELECT
      comment_id,
      board_id,
      comment,
      created_at,
      edited_at
    FROM comment
    WHERE comment_id = #{commentId}
  </select>

  <!--
    댓글 등록

    파라미터:
    - boardId: 게시글 ID
    - comment: 댓글 내용

    반환: 생성된 댓글 ID (useGeneratedKeys)
  -->
  <insert id="insertComment" useGeneratedKeys="true" keyProperty="commentId">
    INSERT INTO comment (
      board_id,
      comment
    ) VALUES (
      #{boardId},
      #{comment}
    )
  </insert>

  <!--
    댓글 수정

    파라미터:
    - commentId: 댓글 ID
    - comment: 댓글 내용
  -->
  <update id="updateComment">
    UPDATE comment
    SET
      comment = #{comment},
      edited_at = CURRENT_TIMESTAMP
    WHERE comment_id = #{commentId}
  </update>

  <!--
    댓글 삭제

    파라미터:
    - commentId: 댓글 ID
  -->
  <delete id="deleteComment">
    DELETE FROM comment
    WHERE comment_id = #{commentId}
  </delete>

  <!--
    게시글의 모든 댓글 삭제

    파라미터:
    - boardId: 게시글 ID
  -->
  <delete id="deleteCommentsByBoardId">
    DELETE FROM comment
    WHERE board_id = #{boardId}
  </delete>

  <!--
    게시글의 댓글 개수 조회

    파라미터:
    - boardId: 게시글 ID

    반환: int
  -->
  <select id="countCommentsByBoardId" resultType="int">
    SELECT COUNT(*)
    FROM comment
    WHERE board_id = #{boardId}
  </select>

</mapper>
