<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
  댓글 Mapper XML

  댓글 조회, 등록, 삭제 등의 SQL 쿼리 정의
-->
<mapper namespace="com.board.dao.CommentDAO">

  <!-- ========================================
       Result Map 정의
       ======================================== -->

  <!--
    댓글 기본 Result Map
    Comment DTO의 모든 필드를 매핑
  -->
  <resultMap id="CommentResultMap" type="Comment">
    <id property="commentId" column="comment_id"/>
    <result property="boardId" column="board_id"/>
    <result property="comment" column="comment"/>
    <result property="createdAt" column="created_at"/>
    <result property="editedAt" column="edited_at"/>
  </resultMap>

  <!-- ========================================
       게시글별 댓글 목록 조회
       ======================================== -->

  <!--
    특정 게시글의 댓글 목록 조회
    등록일시 오름차순 정렬 (오래된 댓글부터 표시)

    @param boardId 게시글 ID
    @return 댓글 목록
  -->
  <select id="selectCommentsByBoardId" resultMap="CommentResultMap">
    SELECT
      comment_id,
      board_id,
      comment,
      created_at,
      edited_at
    FROM comment
    WHERE board_id = #{boardId}
    ORDER BY created_at ASC
  </select>

  <!-- ========================================
       댓글 등록
       ======================================== -->

  <!--
    댓글 등록
    생성된 commentId를 반환 (useGeneratedKeys)

    @param comment 댓글 정보
  -->
  <insert id="insertComment" parameterType="Comment" useGeneratedKeys="true" keyProperty="commentId">
    INSERT INTO comment (
      board_id,
      comment,
      created_at
    ) VALUES (
      #{boardId},
      #{comment},
      CURRENT_TIMESTAMP
    )
  </insert>

  <!-- ========================================
       게시글별 댓글 삭제
       ======================================== -->

  <!--
    특정 게시글의 모든 댓글 삭제
    게시글 삭제 시 사용 (CASCADE 대신 명시적 삭제)

    @param boardId 게시글 ID
  -->
  <delete id="deleteCommentsByBoardId">
    DELETE FROM comment
    WHERE board_id = #{boardId}
  </delete>

</mapper>
